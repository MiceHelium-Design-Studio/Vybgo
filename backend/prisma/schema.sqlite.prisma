generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// NOTE: SQLite in this temporary schema does not support Prisma enums the
// same way PostgreSQL does. For local testing we store those enum values as
// plain strings and use documented constant values in the application.

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  phone     String?  @unique
  isAdmin   Boolean  @default(false)
  password  String
  name      String?
  fcmToken  String?  // Firebase Cloud Messaging token for push notifications
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  rides     Ride[]
}

model Driver {
  id        String   @id @default(uuid())
  email     String   @unique
  phone     String?  @unique
  password  String
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  drives    Drive[]
}

model Ride {
  id          String     @id @default(uuid())
  userId      String
  user        User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  pickup      String
  dropoff     String
  vibe        String
  status      String     @default("PENDING")
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  drive       Drive?
  musicTracks MusicTrack[]
}

model Drive {
  id          String     @id @default(uuid())
  driverId    String
  rideId      String @unique
  driver      Driver     @relation(fields: [driverId], references: [id], onDelete: Cascade)
  ride        Ride       @relation(fields: [rideId], references: [id], onDelete: Cascade)
  status      String     @default("PENDING")
  startedAt   DateTime?
  completedAt DateTime?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  musicTracks MusicTrack[]
}

model MusicTrack {
  id        String   @id @default(uuid())
  title     String
  artist    String?
  vibe      String
  audioUrl  String
  duration  Int?
  rideId    String?
  driveId   String?
  ride      Ride?     @relation(fields: [rideId], references: [id], onDelete: Cascade)
  drive     Drive?    @relation(fields: [driveId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([rideId])
  @@index([driveId])
}
